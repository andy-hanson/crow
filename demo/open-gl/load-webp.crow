import
	crow/c-types: c-int
	crow/cell: *, cell, new
	crow/col/private/arr-low-level: begin-ptr
	crow/ptr: mut-ptr
	webp/decode: WebPDecodeRGBA
	webp/types: WebPFree

webp-rgba-image record mut
	image-data nat8 mut*
	width nat
	height nat

with-webp<a> a(compressed nat8[], cb act a(webp-rgba-image)) unsafe summon
	image = compressed load-webp
	(() => image free-webp) finally () => cb[image]

.load-webp webp-rgba-image(compressed nat8[]) unsafe summon
	width cell c-int = 0,
	height cell c-int = 0,
	uncompressed = compressed.begin-ptr WebPDecodeRGBA compressed.size, width, height
	uncompressed, width->to-nat64, height->to-nat64

.free-webp void(a webp-rgba-image) unsafe summon
	a.image-data WebPFree
