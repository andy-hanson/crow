no-std
import
	crow/pointer: mut-pointer
	crow/bytes-types: bytes512, new
	crow/private/bootstrap: int32, void

# Make this as big as the biggest one I've found, which is on Windows where it is 16 * 128 bits.
# The interpreter uses a fake implementation of this.
__jmp_buf_tag record by-val extern
	spacer bytes512

new __jmp_buf_tag() noctx
	(),

# WARNING: This is declared as `typedef struct __jmp_buf_tag jmp_buf[1];`
# (or on Windows, `typedef _JBTYPE jmp_buf[_JBLEN];` where JBLEN is 16)
# So in some cases it's by value, in others by reference
jmp_buf alias
	__jmp_buf_tag mut*

# WARN: Use _setjmp on Windows
setjmp int32(env jmp_buf) extern<c>

# WARN: Windows only
_setjmp int32(env jmp_buf) extern<kernel32>

###
This is used internally by crow for `throw` and should not be used otherwise.

The interpreter uses a fake implementation.
###
longjmp void(env jmp_buf, val int32) extern<c>
