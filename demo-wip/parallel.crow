import
	crow/io/print: out, print
	crow/private/thread-utils: count-processors

main nat^(_ string[]) summon
	out print "running with {trusted count-processors} processors"
	fprimes nat[][]^ = for x : 1_000_000 .. 1_010_000 parallel
		if x is-prime
			(x,),
	primes <- fprimes
	out print "primes: " ~~ (", " join (for x : primes.flatten; "{x}"))
	()

# intentionally inefficient to demonstrate parallel speedup
is-prime bool(a nat)
	!(2 .. a exists x => a is-multiple-of x)
